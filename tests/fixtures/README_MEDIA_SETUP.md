# Test Media Setup Guide

This directory contains test fixtures and sample media for the Photo Time Aligner test suite.

## Directory Structure

```
fixtures/
├── sample_media/
│   ├── clean/           # Real sample media files (YOU provide these)
│   ├── corrupted/       # Corrupted files (auto-generated by tests)
│   └── batch_test_base/ # Batch test files (auto-generated)
├── helpers/             # Test helper utilities
│   ├── assertion_helpers.py
│   ├── media_generator.py
│   └── performance_helpers.py
└── .gitignore          # Ignore generated files
```

## Adding Sample Media Files

### Why Sample Media is Important

Integration and performance tests need real media files to:
- Verify actual ExifTool operations work correctly
- Test metadata reading and writing with real EXIF structures
- Verify Norwegian character handling in file paths
- Test performance at realistic scale
- Validate corruption detection with real corrupted files

### What You Need to Provide

Place these files in `tests/fixtures/sample_media/clean/`:

1. **photo_clean.jpg** (required)
   - A real JPEG photo with EXIF metadata
   - Should have: CreateDate, Make, Model fields
   - Size: ~1-10 MB is fine
   - Example: Photo from your camera

2. **video_clean_mp4.mp4** (required)
   - A real video file with metadata
   - Supported formats: MP4, MOV, MKV, WebM
   - Should have: creation date metadata
   - Size: ~1-50 MB is fine
   - Example: Screen recording or camera video

3. **photo_clean_cr2.cr2** (optional but recommended)
   - RAW format file (Canon CR2, Nikon NEF, etc.)
   - For testing RAW format support
   - If not available, skip it (tests will be marked xfail)

4. **Øivind_test.jpg** (required)
   - Any media file with Norwegian characters in filename
   - Important for testing Norwegian filename handling
   - Can be a copy of photo_clean.jpg with Norwegian name

### How to Add Files

#### Option 1: Direct File Copy (Simplest)
```bash
# Copy your files into the clean directory
cp /path/to/your/photo.jpg tests/fixtures/sample_media/clean/photo_clean.jpg
cp /path/to/your/video.mp4 tests/fixtures/sample_media/clean/video_clean_mp4.mp4

# Create Norwegian filename version
cp tests/fixtures/sample_media/clean/photo_clean.jpg "tests/fixtures/sample_media/clean/Øivind_test.jpg"
```

#### Option 2: Use Symbolic Links (If on Linux/Mac)
```bash
# Link to files elsewhere on your system
ln -s /path/to/your/photo.jpg tests/fixtures/sample_media/clean/photo_clean.jpg
```

#### Option 3: Through Python Script
```python
from pathlib import Path
import shutil

fixtures_dir = Path("tests/fixtures/sample_media/clean")
fixtures_dir.mkdir(parents=True, exist_ok=True)

# Copy files
shutil.copy("~/Pictures/photo.jpg", fixtures_dir / "photo_clean.jpg")
shutil.copy("~/Videos/video.mp4", fixtures_dir / "video_clean_mp4.mp4")
shutil.copy(fixtures_dir / "photo_clean.jpg", fixtures_dir / "Øivind_test.jpg")
```

### What Gets Generated Automatically

The following files are generated by tests and should NOT be committed to git:

- **corrupted/corrupted_exif.jpg** - JPEG with corrupted EXIF structure
- **corrupted/corrupted_makernotes.jpg** - JPEG with corrupted MakerNotes
- **corrupted/missing_datetime.jpg** - JPEG without datetime metadata
- **batch_test_base/*** - Batch files for performance testing (50, 200, 500 file batches)

These are in `.gitignore` and will be created on-demand by tests.

## Verifying Your Setup

### Check if files exist:
```bash
ls -la tests/fixtures/sample_media/clean/
```

Expected output should include:
```
photo_clean.jpg
video_clean_mp4.mp4
Øivind_test.jpg
photo_clean_cr2.cr2 (optional)
```

### Check if ExifTool can read files:
```bash
exiftool tests/fixtures/sample_media/clean/photo_clean.jpg
exiftool tests/fixtures/sample_media/clean/video_clean_mp4.mp4
```

Should show EXIF metadata for photos and video properties for videos.

## Running Tests with Sample Media

### All tests (requires sample media):
```bash
pytest tests/integration/ -v
```

### Only tests that don't require media:
```bash
pytest tests/unit/ -v
pytest tests/ -m "not skip_without_media" -v
```

### Generate missing media files on-the-fly:
```bash
# Tests will attempt to generate corrupted files if missing
pytest tests/integration/test_corruption_detection.py -v
```

## Troubleshooting

### "Sample media files not available"
This means one or more required files are missing from `tests/fixtures/sample_media/clean/`.

**Solution**: Copy your files to that directory (see "How to Add Files" above).

### "ExifTool not found in PATH"
ExifTool is required for integration tests.

**Solution**: Install ExifTool:
- **Windows**: `choco install exiftool` or download from https://exiftool.org/
- **Mac**: `brew install exiftool`
- **Linux**: `apt-get install libimage-exiftool-perl` (Ubuntu/Debian)

Verify with: `exiftool -ver`

### Files are ignored by git but I want to commit them
Media files are intentionally in `.gitignore` to avoid bloating the repository.

**If you really need to commit them**:
- Use `git add -f` to force-add despite .gitignore
- Or update `.gitignore` to remove the pattern
- Consider: This adds ~50MB+ per person's clone

## Minimal Setup for Quick Start

If you only have a few seconds, minimum viable setup:

1. Find any JPEG photo on your computer
2. Find any video file (MP4, MOV, etc.)
3. Copy them to `tests/fixtures/sample_media/clean/`:
   ```bash
   cp any_photo.jpg tests/fixtures/sample_media/clean/photo_clean.jpg
   cp any_video.mp4 tests/fixtures/sample_media/clean/video_clean_mp4.mp4
   cp tests/fixtures/sample_media/clean/photo_clean.jpg "tests/fixtures/sample_media/clean/Øivind_test.jpg"
   ```
4. Run tests: `pytest tests/integration/ -v`

That's it! Tests will work with whatever media files you provide.

## File Size Recommendations

| File | Min Size | Recommended | Max (for CI/CD) |
|------|----------|-------------|-----------------|
| photo_clean.jpg | 100 KB | 1-5 MB | 10 MB |
| video_clean_mp4.mp4 | 1 MB | 5-20 MB | 50 MB |
| photo_clean_cr2.cr2 | 10 MB | 20-30 MB | 50 MB |
| Øivind_test.jpg | 100 KB | 1-5 MB | 10 MB |

Larger files will slow down test execution, but CI/CD should handle up to the max sizes.

## Questions?

For help or issues with test media setup, check:
1. Test output messages - usually very specific
2. Fixture documentation: `tests/conftest.py`
3. Helper utilities: `tests/fixtures/helpers/media_generator.py`
